{"ast":null,"code":"import axios from \"axios\";\nimport SummaryApi, { baseURL } from \"../common/SummaryApi\";\nconst Axios = axios.create({\n  baseURL: baseURL,\n  withCredentials: true\n});\n\n//sending access token in the header\nAxios.interceptors.request.use(async config => {\n  const accessToken = localStorage.getItem('accesstoken');\n  if (accessToken) {\n    config.headers.Authorization = `Bearer ${accessToken}`;\n  }\n  return config;\n}, error => {\n  return Promise.reject(error);\n});\n\n//extend the life span of access token with \n// the help refresh\nAxios.interceptors.request.use(response => {\n  return response;\n}, async error => {\n  let originRequest = error.config;\n  if (error.response.status === 401 && !originRequest.retry) {\n    originRequest.retry = true;\n    const refreshToken = localStorage.getItem(\"refreshToken\");\n    if (refreshToken) {\n      const newAccessToken = await refreshAccessToken(refreshToken);\n      if (newAccessToken) {\n        originRequest.headers.Authorization = `Bearer ${newAccessToken}`;\n        return Axios(originRequest);\n      }\n    }\n  }\n  return Promise.reject(error);\n});\nconst refreshAccessToken = async refreshToken => {\n  try {\n    const response = await Axios({\n      ...SummaryApi.refreshToken,\n      headers: {\n        Authorization: `Bearer ${refreshToken}`\n      }\n    });\n    const accessToken = response.data.data.accessToken;\n    localStorage.setItem('accesstoken', accessToken);\n    return accessToken;\n  } catch (error) {\n    console.log(error);\n  }\n};\nexport default Axios;","map":{"version":3,"names":["axios","SummaryApi","baseURL","Axios","create","withCredentials","interceptors","request","use","config","accessToken","localStorage","getItem","headers","Authorization","error","Promise","reject","response","originRequest","status","retry","refreshToken","newAccessToken","refreshAccessToken","data","setItem","console","log"],"sources":["D:/movie_trailer/movie-watching/src/utils/Axios.js"],"sourcesContent":["import axios from \"axios\";\r\nimport SummaryApi , { baseURL } from \"../common/SummaryApi\";\r\n\r\nconst Axios = axios.create({\r\n    baseURL : baseURL,\r\n    withCredentials : true\r\n})\r\n\r\n//sending access token in the header\r\nAxios.interceptors.request.use(\r\n    async(config)=>{\r\n        const accessToken = localStorage.getItem('accesstoken')\r\n\r\n        if(accessToken){\r\n            config.headers.Authorization = `Bearer ${accessToken}`\r\n        }\r\n\r\n        return config\r\n    },\r\n    (error)=>{\r\n        return Promise.reject(error)\r\n    }\r\n)\r\n\r\n//extend the life span of access token with \r\n// the help refresh\r\nAxios.interceptors.request.use(\r\n    (response)=>{\r\n        return response\r\n    },\r\n    async(error)=>{\r\n        let originRequest = error.config \r\n\r\n        if(error.response.status === 401 && !originRequest.retry){\r\n            originRequest.retry = true\r\n\r\n            const refreshToken = localStorage.getItem(\"refreshToken\")\r\n\r\n            if(refreshToken){\r\n                const newAccessToken = await refreshAccessToken(refreshToken)\r\n\r\n                if(newAccessToken){\r\n                    originRequest.headers.Authorization = `Bearer ${newAccessToken}`\r\n                    return Axios(originRequest)\r\n                }\r\n            }\r\n        }\r\n        \r\n        return Promise.reject(error)\r\n    }\r\n)\r\n\r\n\r\nconst refreshAccessToken = async(refreshToken)=>{\r\n    try {\r\n        const response = await Axios({\r\n            ...SummaryApi.refreshToken,\r\n            headers : {\r\n                Authorization : `Bearer ${refreshToken}`\r\n            }\r\n        })\r\n\r\n        const accessToken = response.data.data.accessToken\r\n        localStorage.setItem('accesstoken',accessToken)\r\n        return accessToken\r\n    } catch (error) {\r\n        console.log(error)\r\n    }\r\n}\r\n\r\nexport default Axios"],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,OAAOC,UAAU,IAAKC,OAAO,QAAQ,sBAAsB;AAE3D,MAAMC,KAAK,GAAGH,KAAK,CAACI,MAAM,CAAC;EACvBF,OAAO,EAAGA,OAAO;EACjBG,eAAe,EAAG;AACtB,CAAC,CAAC;;AAEF;AACAF,KAAK,CAACG,YAAY,CAACC,OAAO,CAACC,GAAG,CAC1B,MAAMC,MAAM,IAAG;EACX,MAAMC,WAAW,GAAGC,YAAY,CAACC,OAAO,CAAC,aAAa,CAAC;EAEvD,IAAGF,WAAW,EAAC;IACXD,MAAM,CAACI,OAAO,CAACC,aAAa,GAAG,UAAUJ,WAAW,EAAE;EAC1D;EAEA,OAAOD,MAAM;AACjB,CAAC,EACAM,KAAK,IAAG;EACL,OAAOC,OAAO,CAACC,MAAM,CAACF,KAAK,CAAC;AAChC,CACJ,CAAC;;AAED;AACA;AACAZ,KAAK,CAACG,YAAY,CAACC,OAAO,CAACC,GAAG,CACzBU,QAAQ,IAAG;EACR,OAAOA,QAAQ;AACnB,CAAC,EACD,MAAMH,KAAK,IAAG;EACV,IAAII,aAAa,GAAGJ,KAAK,CAACN,MAAM;EAEhC,IAAGM,KAAK,CAACG,QAAQ,CAACE,MAAM,KAAK,GAAG,IAAI,CAACD,aAAa,CAACE,KAAK,EAAC;IACrDF,aAAa,CAACE,KAAK,GAAG,IAAI;IAE1B,MAAMC,YAAY,GAAGX,YAAY,CAACC,OAAO,CAAC,cAAc,CAAC;IAEzD,IAAGU,YAAY,EAAC;MACZ,MAAMC,cAAc,GAAG,MAAMC,kBAAkB,CAACF,YAAY,CAAC;MAE7D,IAAGC,cAAc,EAAC;QACdJ,aAAa,CAACN,OAAO,CAACC,aAAa,GAAG,UAAUS,cAAc,EAAE;QAChE,OAAOpB,KAAK,CAACgB,aAAa,CAAC;MAC/B;IACJ;EACJ;EAEA,OAAOH,OAAO,CAACC,MAAM,CAACF,KAAK,CAAC;AAChC,CACJ,CAAC;AAGD,MAAMS,kBAAkB,GAAG,MAAMF,YAAY,IAAG;EAC5C,IAAI;IACA,MAAMJ,QAAQ,GAAG,MAAMf,KAAK,CAAC;MACzB,GAAGF,UAAU,CAACqB,YAAY;MAC1BT,OAAO,EAAG;QACNC,aAAa,EAAG,UAAUQ,YAAY;MAC1C;IACJ,CAAC,CAAC;IAEF,MAAMZ,WAAW,GAAGQ,QAAQ,CAACO,IAAI,CAACA,IAAI,CAACf,WAAW;IAClDC,YAAY,CAACe,OAAO,CAAC,aAAa,EAAChB,WAAW,CAAC;IAC/C,OAAOA,WAAW;EACtB,CAAC,CAAC,OAAOK,KAAK,EAAE;IACZY,OAAO,CAACC,GAAG,CAACb,KAAK,CAAC;EACtB;AACJ,CAAC;AAED,eAAeZ,KAAK","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}